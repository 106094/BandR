<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Barcode + OCR Scanner</title>
  <style>
    body { margin:0; font-family:system-ui,sans-serif; background:#111; color:#fff; min-height:100vh; display:flex; align-items:center; justify-content:center; }
    .shell { text-align:center; padding:2rem; }
    .card { background:#222; padding:2rem; border-radius:16px; box-shadow:0 8px 32px rgba(0,0,0,0.5); max-width:90%; }
    button { margin-top:1rem; padding:1rem 2rem; font-size:1.2rem; background:#0f0; color:#000; border:none; border-radius:12px; cursor:pointer; }
    video { max-width:100%; border:4px solid #0f0; border-radius:12px; margin:1rem 0; background:#000; }
  </style>
</head>

<body>

  <!-- HTTPS GUARD — MUST BE THE VERY FIRST THING EXECUTED -->
  <script>
    if (location.protocol !== 'https:' && location.hostname !== 'localhost' && location.hostname !== '127.0.0.1') {
      document.body.innerHTML = `
        <div class="shell">
          <div class="card">
            <h2>HTTPS Required</h2>
            <p>Camera access only works on secure pages (HTTPS).</p>
            <p><strong>Works on:</strong><br>
               • GitHub Pages<br>
               • Vercel / Netlify<br>
               • Any proper HTTPS server</p>
            <small>Current URL: ${location.href}</small>
          </div>
        </div>`;
      throw new Error("HTTPS required"); // stops everything else
    }
  </script>

  <!-- Your real app starts here -->
  <div class="shell">
    <div class="card">
      <h1>Barcode + OCR Scanner</h1>
      <button onclick="openScanner('result')">Start Scanning</button>
      <p>Result: <input id="result" size="40" readonly style="font-family:monospace; font-size:1.2em;"></p>
      <video id="video" playsinline muted></video>
      <div id="status"></div>
    </div>
  </div>

  <!-- Rest of your scanner code (ZXing + Tesseract) -->
  <script type="module">
    // ... (paste the full working scanner code from my previous message here)
    // It will only run if HTTPS check passed
  </script>
</body>
</html>
